{% extends 'layout.html' %} {% block title %}Compare Organization Compliance - CTGov Compliance{% endblock %} {% block
content %}
<div class="grid-container-full">
    <div class="grid-row grid-gap">
        <div class="grid-col-3 padding-1">
            <div class="grid-row grid-gap margin-bottom-2">
                <div class="grid-col-fill text-left">
                    <h2 class="usa-heading margin-y-1 font-family-sans">Organization Statistics</h2>
                </div>
            </div>
            <!-- Summary Statistics -->
            <div class="grid-row grid-gap margin-bottom-2">
                <div class="grid-col-12">
                    <div class="grid-row">
                        <div class="grid-col-10">
                            <p class="font-sans-lg margin-0">Total Organizations</p>
                        </div>
                        <div class="grid-col-2 display-flex flex-justify-end">
                            <p class="font-sans-lg margin-0">{{ org_compliance|length }}</p>
                        </div>
                    </div>
                </div>
            </div>
            <div class="grid-row grid-gap margin-bottom-2">
                <div class="grid-col-12">
                    <div class="grid-row">
                        <div class="grid-col-10">
                            <p class="font-sans-lg margin-0">Average Compliance Rate</p>
                        </div>
                        <div class="grid-col-2 display-flex flex-justify-end">
                            <p class="font-sans-lg margin-0">
                                {% set ns = namespace(total_rate=0) %}
                                {% for org in org_compliance %}
                                {% set compliance = (org.on_time_count / org.total_trials * 100) if org.total_trials > 0
                                else 0 %}
                                {% set ns.total_rate = ns.total_rate + compliance %}
                                {% endfor %}
                                {{ (ns.total_rate / (org_compliance|length) if org_compliance|length > 0 else
                                0)|round|int }}%
                            </p>
                        </div>
                    </div>
                </div>
            </div>
            <div class="grid-row grid-gap margin-bottom-2">
                <div class="grid-col-12">
                    <div class="grid-row">
                        <div class="grid-col-10">
                            <p class="font-sans-lg margin-0">Total Trials</p>
                        </div>
                        <div class="grid-col-2 display-flex flex-justify-end">
                            <p class="font-sans-lg margin-0">
                                {% set ns_trials = namespace(total_trials=0) %}
                                {% for org in org_compliance %}
                                {% set ns_trials.total_trials = ns_trials.total_trials + org.total_trials %}
                                {% endfor %}
                                {{ ns_trials.total_trials }}
                            </p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Filter Options -->
            <div class="grid-row grid-gap margin-bottom-2">
                <div class="grid-col-12">
                    <h2 class="usa-heading margin-y-1 font-family-sans">Filter Organizations</h2>
                    <form class="usa-form margin-0 padding-0  width-full maxw-full" method="GET">
                        <div class="grid-row grid-gap">
                            <div class="grid-col-12">
                                <label class="usa-label margin-y-1" for="min-compliance">Compliance Rate
                                    (%)</label>
                                <div class="grid-row">
                                    <div class="grid-col-5">
                                        <input class="usa-input" placeholder="Min" type="number" id="min-compliance"
                                            name="min_compliance" min="0" max="100"
                                            value="{{ request.args.get('min_compliance', '') }}">
                                    </div>
                                    <div class="grid-col-2 display-flex flex-align-center flex-justify-center">
                                        &mdash;
                                    </div>
                                    <div class="grid-col-5">
                                        <input class="usa-input" placeholder="Max" type="number" id="min-compliance"
                                            name="min_compliance" min="0" max="100"
                                            value="{{ request.args.get('min_compliance', '') }}">
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="grid-row grid-gap">
                            <div class="grid-col-12">
                                <label class="usa-label margin-y-1" for="min-trials">Number of Trials</label>
                                <div class="grid-row">
                                    <div class="grid-col-5">
                                        <input class="usa-input" placeholder="Min" type="number" id="min-trials"
                                            name="min_trials" min="0" value="{{ request.args.get('min_trials', '') }}">
                                    </div>
                                    <div class="grid-col-2 display-flex flex-align-center flex-justify-center">
                                        &mdash;
                                    </div>
                                    <div class="grid-col-5">
                                        <input class="usa-input" placeholder="Max" type="number" id="max-trials"
                                            name="max_trials" min="0" value="{{ request.args.get('max_trials', '') }}">
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="grid-row grid-gap">
                            <div class="grid-col-12 display-flex flex-justify-end">
                                <button class="usa-button margin-0" type="submit">Apply Filters</button>
                            </div>
                        </div>
                    </form>
                </div>
            </div>
        </div>
        <div class="grid-col-9 padding-1">
            <!-- Organization Table -->
            {% include 'dashboards/organization_table.html' with context %}
        </div>
    </div>
</div>
{% endblock %}