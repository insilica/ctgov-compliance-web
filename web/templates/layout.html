<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="description"
        content="CTGov Compliance - Clinical trial compliance monitoring and reporting dashboard" />
    <meta name="keywords" content="clinical trials, compliance, reporting, CTGov, FDA, research" />
    <meta name="author" content="CTGov Compliance" />
    <title>
        CTGov Compliance
        {% block title %}
        {% endblock title %}
    </title>
    <link rel="icon" type="image/x-icon" href="{{ url_for('static', filename='img/favicon.ico') }}" />
    <link href="https://cdn.jsdelivr.net/npm/remixicon@4.6.0/fonts/remixicon.css" rel="stylesheet" />
    <link href="{{ url_for('static', filename='dist/css/uswds.min.css') }}" rel="stylesheet" />
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}" />
</head>

<body>
    <script src="{{url_for('static', filename='dist/js/uswds.min.js')}}"></script>
    <div class="usa-overlay"></div>
    <header class="usa-header bg-base-lightest">
        <div class="desktop:grid-container-widescreen margin-x-0 width-full maxw-full">
            <div class="usa-nav-container padding-2 margin-x-0 width-full maxw-full">
                <div class="grid-row">
                    <div class="grid-col-12 display-flex flex-row flex-align-center">
                        <div class="usa-navbar">
                            <div class="usa-logo">
                                <span class="usa-logo__text padding-x-2 padding-y-2">
                                    <h1>
                                        <a class="usa-logo__text" href="{{ url_for('routes.index') }}"
                                            title="CTGov Compliance">CTGov Compliance</a>
                                    </h1>
                                </span>
                            </div>
                        </div>
                        <button type="button" class="usa-menu-btn margin-left-auto bg-base-lightest">
                            <i class="ri-menu-line" style="color: #000000; font-size: 1.1rem;"></i>
                        </button>
                        <div class="usa-nav margin-left-auto">
                            <ul
                                class="usa-nav__links padding-y-2 display-flex flex-row flex-align-center usa-list--unstyled">
                                {% if current_user.is_authenticated %}
                                <li class="usa-nav__item margin-x-1">
                                    <span class="font-ui-md">{{ current_user.email.split('@')[0] }}</span>
                                </li>
                                <li class="usa-nav__item padding-x-1 margin-right-1">
                                    <span class="font-ui-md">|</span>
                                </li>
                                <li class="usa-nav__item">
                                    <a class="font-ui-md usa-link" href="{{ url_for('auth.logout') }}">
                                        <span>Logout</span>
                                        <i class="ri-logout-box-line margin-right-1"></i>
                                    </a>
                                </li>
                                {% endif %}
                            </ul>
                        </div>
                    </div>
                </div>
                {% if current_user.is_authenticated %}
                <div class="grid-row">
                    <nav aria-label="Primary Navigation Menu" class="usa-nav">
                        <div class="usa-nav__inner">
                            <button type="button" class="usa-nav__close margin-1">
                                <svg class="usa-icon" alt="Close" role="img">
                                    <use href="{{ url_for('static', filename='dist/img/sprite.svg') }}#close">
                                    </use>
                                </svg>
                            </button>
                            <ul class="usa-nav__primary usa-accordion usa-list--unstyled">
                                <li class="usa-nav__primary-item hover:bg-primary-lighter">
                                    <a href="{{ url_for('routes.index') }}" class="usa-nav-link">
                                        <span class="font-ui-md">Home</span>
                                    </a>
                                </li>
                                <li class="usa-nav__primary-item hover:bg-primary-lighter">
                                    <a href="{{ url_for('routes.query_workspace') }}" class="usa-nav-link">
                                        <span class="font-ui-md">Query Workspace</span>
                                    </a>
                                </li>
                                <li class="usa-nav__primary-item hover:bg-primary-lighter">
                                    <a href="{{ url_for('routes.reporting_dashboard') }}" class="usa-nav-link">
                                        <span class="font-ui-md">Control Center</span>
                                    </a>
                                </li>
                                <li class="usa-nav__primary-item hover:bg-primary-lighter">
                                    <button type="button" class="usa-accordion__button usa-nav__link"
                                        aria-expanded="false" aria-controls="extended-nav-section-one"
                                        title="Organizations" aria-label="Organizations"
                                        aria-controls="extended-nav-section-one">
                                        <span class="font-ui-md">Organizations</span>
                                    </button>
                                    <ul id="extended-nav-section-one" class="usa-nav__submenu">
                                        <li class="usa-nav__submenu-item">
                                            <a href="{{ url_for('routes.show_compare_organizations_dashboard') }}">
                                                <span>Compare Organizations</span>
                                            </a>
                                        </li>
                                        {% if current_user.organization_ids %}
                                        <li class="usa-nav__submenu-item">
                                            <a
                                                href="{{ url_for('routes.show_organization_dashboard', org_ids=(current_user.organization_ids|urlencode) ) }}">
                                                <span>View my Organizations</span>
                                            </a>
                                        </li>
                                        {% endif %}
                                    </ul>
                                </li>
                                <li class="usa-nav__primary-item hover:bg-primary-lighter">
                                    <button type="button" class="usa-accordion__button usa-nav__link"
                                        aria-expanded="false" aria-controls="extended-nav-section-two">
                                        <span class="font-ui-md">Users</span>
                                    </button>
                                    <ul id="extended-nav-section-two" class="usa-nav__submenu">
                                        <!-- TODO: Create a compare users dashboard? -->
                                        <!-- <li class="usa-nav__submenu-item">
                                            <a href="">
                                                <span>Compare Users</span>
                                            </a>
                                        </li> -->
                                        {% if current_user.trials %}
                                        <li class="usa-nav__submenu-item">
                                            <a
                                                href="{{ url_for('routes.show_user_dashboard', user_id=current_user.id) }}">
                                                <span>View my Trials</span>
                                            </a>
                                        </li>
                                        {% endif %}
                                    </ul>
                                </li>
                            </ul>
                        </div>
                    </nav>
                </div>
            </div>
            {% endif %}
        </div>
    </header>
    <main>
        {% with messages = get_flashed_messages(with_categories=true) %}
        {% if messages %}
        <div class="grid-container">
            {% for category, message in messages %}
            <div class="usa-alert usa-alert--{{ category if category != 'message' else 'info' }} margin-y-2"
                role="alert">
                <div class="usa-alert__body">
                    <p class="usa-alert__text">{{ message|safe }}</p>
                </div>
            </div>
            {% endfor %}
        </div>
        {% endif %}
        {% endwith %}
        {% block content %}
        {% endblock content %}
    </main>

    <!-- Theme Controls Footer -->
    <footer class="usa-footer usa-footer--slim bg-primary-darker" role="contentinfo">
        <div class="grid-container">
            <div class="grid-row">
                <div class="grid-col-12">
                    <div class="usa-footer__primary-section">
                        <div class="usa-footer__primary-container grid-row">
                            <div class="mobile:grid-col-12 tablet:grid-col-8">
                                <div class="usa-footer__brand-links margin-y-2">
                                    <p class="usa-footer__contact-info font-sans-sm margin-0">
                                        <strong>CTGov Compliance</strong> - Clinical trial compliance monitoring and
                                        reporting
                                    </p>
                                </div>
                            </div>
                            <div
                                class="mobile:grid-col-12 tablet:grid-col-4 display-flex flex-align-center flex-justify-end">
                                <div class="usa-footer__contact-links">
                                    <div class="display-flex flex-justify-end flex-align-center">
                                        <!-- Theme Settings -->
                                        <div class="margin-right-2">
                                            <button type="button" id="theme-settings-toggle"
                                                class="usa-button display-flex flex-align-center" aria-expanded="false"
                                                aria-controls="theme-settings-dropdown" title="Theme Settings">
                                                <i class="ri-palette-line margin-right-1" aria-hidden="true"></i>
                                                <span class="font-sans-sm">Theme</span>
                                            </button>

                                            <!-- Theme Settings Dropdown -->
                                            <div id="theme-settings-dropdown"
                                                class="usa-dropdown-menu theme-settings-dropdown display-none"
                                                role="menu" aria-labelledby="theme-settings-toggle">
                                                <div class="theme-settings-content">
                                                    <h4 class="margin-1 font-sans-md" style="text-align: left;">
                                                        Appearance</h4>

                                                    <!-- Quick Theme Toggle -->
                                                    <div class="margin-bottom-2">
                                                        <button
                                                            onclick="document.getElementById('collapsible').classList.toggle('display-none');"
                                                            type="button" id="theme-toggle"
                                                            class="usa-button usa-button--outline usa-button--secondary width-full"
                                                            aria-label="Toggle between light and dark theme">
                                                            <i class="ri-moon-line margin-right-1"
                                                                aria-hidden="true"></i>
                                                            <span class="theme-toggle-text">Auto (Light)</span>
                                                        </button>
                                                    </div>

                                                    <!-- Theme Options -->
                                                    <div class="theme-options">
                                                        <div class="usa-radio">
                                                            <input class="usa-radio__input" id="theme-light"
                                                                type="radio" name="theme-preference" value="light">
                                                            <label class="usa-radio__label font-sans-xs"
                                                                for="theme-light">
                                                                <i class="ri-sun-line margin-right-1"
                                                                    aria-hidden="true"></i>
                                                                Light
                                                            </label>
                                                        </div>

                                                        <div class="usa-radio">
                                                            <input class="usa-radio__input" id="theme-dark" type="radio"
                                                                name="theme-preference" value="dark">
                                                            <label class="usa-radio__label font-sans-xs"
                                                                for="theme-dark">
                                                                <i class="ri-moon-line margin-right-1"
                                                                    aria-hidden="true"></i>
                                                                Dark
                                                            </label>
                                                        </div>

                                                        <div class="usa-radio">
                                                            <input class="usa-radio__input" id="theme-auto" type="radio"
                                                                name="theme-preference" value="auto" checked>
                                                            <label class="usa-radio__label font-sans-xs"
                                                                for="theme-auto">
                                                                <i class="ri-computer-line margin-right-1"
                                                                    aria-hidden="true"></i>
                                                                Auto (System)
                                                            </label>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>

                                        <!-- Back to Top Button -->
                                        <div>
                                            <a href="#" class="usa-footer__return-to-top usa-button padding-105">
                                                <i class="ri-arrow-up-double-line" aria-hidden="true"></i>
                                                <span class="usa-sr-only">Back to top</span>
                                            </a>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </footer>

    <!-- Scripts -->
    <!-- Add theme manager script (must load first) -->
    <script src="{{ url_for('static', filename='js/theme-manager.js') }}"></script>
    <!-- Add column configuration script -->
    <script src="{{ url_for('static', filename='js/column-config.js') }}"></script>
    <!-- Add search autocomplete script -->
    <script src="{{ url_for('static', filename='js/search-autocomplete.js') }}"></script>

    <!-- Theme settings dropdown functionality -->
    <script>
        document.addEventListener('DOMContentLoaded', function () {
            const themeSettingsToggle = document.getElementById('theme-settings-toggle');
            const themeSettingsDropdown = document.getElementById('theme-settings-dropdown');
            const themeRadios = document.querySelectorAll('input[name="theme-preference"]');

            // Toggle dropdown
            function toggleDropdown() {
                const isExpanded = themeSettingsToggle.getAttribute('aria-expanded') === 'true';
                themeSettingsToggle.setAttribute('aria-expanded', !isExpanded);
                themeSettingsDropdown.classList.toggle('display-none');

                // Update arrow direction
                const arrow = themeSettingsToggle.querySelector('.ri-arrow-up-s-line');
                if (arrow) {
                    arrow.className = isExpanded ? 'ri-arrow-up-s-line margin-left-1' : 'ri-arrow-down-s-line margin-left-1';
                }
            }

            // Close dropdown when clicking outside
            function closeDropdown() {
                themeSettingsToggle.setAttribute('aria-expanded', 'false');
                themeSettingsDropdown.classList.add('display-none');
                const arrow = themeSettingsToggle.querySelector('.ri-arrow-down-s-line, .ri-arrow-up-s-line');
                if (arrow) {
                    arrow.className = 'ri-arrow-up-s-line margin-left-1';
                }
            }

            // Event listeners
            themeSettingsToggle.addEventListener('click', function (e) {
                e.stopPropagation();
                toggleDropdown();
            });

            // Close dropdown when clicking outside
            document.addEventListener('click', function (e) {
                if (!themeSettingsDropdown.contains(e.target) && e.target !== themeSettingsToggle) {
                    closeDropdown();
                }
            });

            // Handle theme radio button changes
            themeRadios.forEach(radio => {
                radio.addEventListener('change', function () {
                    if (this.checked && window.themeManager) {
                        window.themeManager.setTheme(this.value);
                        closeDropdown();
                    }
                });
            });

            // Update radio buttons when theme changes
            document.addEventListener('theme-changed', function (e) {
                const currentTheme = e.detail.theme;
                themeRadios.forEach(radio => {
                    radio.checked = radio.value === currentTheme;
                });
            });

            // Initialize radio button state
            if (window.themeManager) {
                const currentTheme = window.themeManager.getCurrentTheme();
                themeRadios.forEach(radio => {
                    radio.checked = radio.value === currentTheme;
                });
            }
        });

        function toggleCollapsible() {
            const collapsible = document.getElementById('collapsible');
            const toggleSearch = document.getElementById('toggle-search');
            collapsible.classList.toggle('display-none');
            toggleSearch.classList.toggle('ri-arrow-up-s-line');
            toggleSearch.classList.toggle('ri-arrow-down-s-line');
        }
    </script>
</body>

</html>
