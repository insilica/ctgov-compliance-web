# CTGOV Compliance Web Application

This project provides a basic Flask web interface for viewing clinical
trial compliance information. It also includes supporting scripts and
database services.

## Components

- **Flask** application located in `web/`.
- **PostgreSQL** for application data.
- **Flyway** for database migrations.
- **Blazegraph** for graph data with a script to load mock trials.
- Connection placeholders for **AWS Neptune**.

## Requirements

- **NixOS** must be downloaded onto the system
  - Run in Terminal (MacOS):
    ```
    sh <(curl --proto '=https' --tlsv1.2 -L https://nixos.org/nix/install)
    ```
  - [Windows Instructions](https://nixos.org/download/#nix-install-windows)
- **UV** must be downloaded onto the system
  - Run in your CLI with Homebrew:
    ```
    brew install uv
    ```
  - Alternatively, you may use the following:
    ```
    curl -LsSf https://astral.sh/uv/install.sh | sh
    ```

## Usage

```bash
nix develop
```

This command will download all dependencies, setup your AWS profile onto the system,

### File Cleanup

Running the command below will delete files autogenerated by the `nix develop` command. It will also kill the PostgreSQL server.

```bash
source scripts/flake/clean.sh
```

### Mock Data

_Not required; ran using `nix develop`_

For convenience a helper script is included to load mock organizations,
users, trials and compliance information into both PostgreSQL and Blazegraph.

```bash
python scripts/init_mock_data.py
```

### Running the Flask App

_Not required; ran using `nix develop`_

After the services are running and mock data is loaded you can start the
development server:

```bash
flask run --host 0.0.0.0 --port 6525
```

#### Development Auto-Authentication

For development convenience, you can enable automatic user authentication:

```bash
export ENVIRONMENT=dev
flask run --host 0.0.0.0 --port 6525
```

When `ENVIRONMENT=dev` is set, you'll be automatically logged in as `user1@example.com` when visiting any protected route. This eliminates the need for manual login during development.

### Account Management

You can create an account directly in the application and reset your password when needed.

1. Visit `/register` to sign up for a new account.
2. Use `/reset` to generate a password reset link.
